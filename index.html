<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tawฤfuq | ููุตูุฉ ูุทููุฉ ูุชูุธูู ุงูุฎุทุจุฉ ูุจูุงุก ูุฑุงุฑ ุฒูุงุฌ ูุงุนู</title>
  <meta name="description" content="ุชูุงูู | Tawฤfuq โ ููุตูุฉ ูุทููุฉ ูุชูุธูู ุงูุฎุทุจุฉ ูุจูุงุก ูุฑุงุฑ ุฒูุงุฌ ูุงุนู ุนุจุฑ ุงุฎุชุจุงุฑุงุช ุชูุงููุ ุชูุงุตู ุดุฑุนู ุจุฅุดุฑุงูุ ูุญุชูู ุชูุนููุ ูุฅุฑุดุงุฏ ุฃุณุฑู." />

  <!-- Tailwind (CDN) -->
  <script defer src="https://cdn.tailwindcss.com"></script>
  <!-- Icons -->
  <script defer src="https://kit.fontawesome.com/4fdf4f8e7d.js" crossorigin="anonymous"></script>
  <!-- Charts & Utils -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    :root{
      --brand:#0EA5A8;        /* Turquoise */
      --brand-dk:#0B7C7E;     /* Dark Turquoise */
      --sand:#E7D7C9;         /* Sand */
      --ink:#0f172a;          /* Dark text */
      --muted:#64748b;        /* Muted text */
      --card:#ffffff;         /* Card bg */
      --gray:#f1f5f9;         /* Light gray bg */
      --success:#16A34A; --warn:#EAB308; --danger:#DC2626;
    }
    body{ background:#f7fafc; color:var(--ink); }
    .card{ background:var(--card); border:1px solid #e5e7eb; border-radius:1rem; padding:1.25rem; }
    .chip{ display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .6rem; border:1px solid #e5e7eb; border-radius:.75rem; background:#fff; }
    .btn{ padding:.6rem 1rem; border-radius:.75rem; }
    .btn-brand{ background:var(--brand); color:#fff; }
    .btn-ghost{ background:#f3f4f6; }
    .title{ color:var(--brand-dk); }
    .muted{ color:var(--muted); }
    .badge{ display:inline-block; padding:.25rem .5rem; border:1px solid #e5e7eb; border-radius:.5rem; font-size:.75rem; background:#fff; }
    .hero{
      background: radial-gradient(1200px 600px at 80% -20%, rgba(14,165,168,.12), transparent 60%),
                  radial-gradient(900px 400px at 10% -10%, rgba(231,215,201,.35), transparent 55%);
    }
    /* toast */
    #toast{ transition:opacity .25s ease; }
    /* print */
    @media print{
      header, aside, nav, #about, #about-full, #impact, #accounts, #subs, #sponsor, #support, #kpis, #test .grid, #verify, #wali, #advisors-admin, #bookings, #governance, #policies, #terms, footer { display:none !important; }
      #resultsArea{ display:block !important; }
      #resultsArea .badge{ border:1px solid #000 !important; }
      body{ background:#fff; }
    }
  </style>
</head>
<body class="antialiased">

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 hidden px-4 py-2 rounded-lg text-white"></div>

  <!-- Header -->
  <header class="bg-white border-b sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4 grid grid-cols-3 items-center">
      <!-- ูููู: ุดุนุงุฑ ุชูุงูู (SVG ูุถููู) -->
      <div class="flex justify-start">
        <a href="#about" class="inline-flex items-center gap-2 group">
          <svg width="140" height="36" viewBox="0 0 520 140" xmlns="http://www.w3.org/2000/svg" aria-label="ุดุนุงุฑ ุชูุงูู">
            <defs>
              <linearGradient id="tg" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#0EA5A8"/><stop offset="1" stop-color="#0B7C7E"/>
              </linearGradient>
            </defs>
            <g fill="url(#tg)">
              <circle cx="28" cy="70" r="20" opacity=".25"/>
              <path d="M20 70c0-22 18-40 40-40s40 18 40 40-18 40-40 40" fill="none" stroke="url(#tg)" stroke-width="10" stroke-linecap="round"/>
            </g>
            <text x="110" y="83" font-family="Tajawal, system-ui" font-size="40" fill="#0B7C7E">ุชูุงูู</text>
          </svg>
          <span class="sr-only">Tawฤfuq</span>
        </a>
      </div>
      <!-- ูุณุท: ุงูุนููุงู -->
      <div class="text-center">
        <div class="text-sm sm:text-base md:text-lg font-bold title">Tawฤfuq | ููุตูุฉ ูุทููุฉ ูุชูุธูู ุงูุฎุทุจุฉ ูุจูุงุก ูุฑุงุฑ ุฒูุงุฌ ูุงุนู</div>
        <div class="text-xs md:text-sm muted">ุงุฎุชุจุงุฑุงุช ุชูุงูู ูููููุฉ โข ุชูุงุตู ุดุฑุนู ุจุฅุดุฑุงู โข ุฅุฑุดุงุฏ ุฃุณุฑู โข ูุญุชูู ุชูุนูู</div>
      </div>
      <!-- ูุณุงุฑ: ุฑุคูุฉ 2030 + ุชูุจูุฉ -->
      <div class="flex justify-end items-center gap-3">
        <img src="vision2030.png" alt="ุดุนุงุฑ ุฑุคูุฉ 2030" class="h-9 w-auto" />
        <img src="talbiya.png" alt="ุดุนุงุฑ ูุจุงุฏุฑุฉ ุชูุจูุฉ" class="h-9 w-auto" />
      </div>
    </div>
    <!-- ุดุฑูุท ุชูููู ุจุณูุท -->
    <nav class="border-t">
      <div class="max-w-7xl mx-auto px-4 py-2 text-sm flex flex-wrap gap-2">
        <a href="#about" class="px-3 py-1 rounded-lg hover:bg-gray-50">ููุงุฐุง ุชูุงููุ</a>
        <a href="#about-full" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุนู ุงูููุตูุฉ</a>
        <a href="#impact" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุฃุซุฑ</a>
        <a href="#accounts" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุญุณุงุจุงุช ูุงูุฎุฏูุงุช</a>
        <a href="#subs" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุงุดุชุฑุงูุงุช</a>
        <a href="#sponsor" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุจุงูุงุช ุงูุฑุนุงูุฉ</a>
        <a href="#kpis" class="px-3 py-1 rounded-lg hover:bg-gray-50">ููุญุฉ ุงููุคุดุฑุงุช</a>
        <a href="#test" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงุฎุชุจุงุฑ ุงูุชูุงูู</a>
        <a href="#verify" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงุณุชุนูุงู ุงูุฌูุงุช</a>
        <a href="#wali" class="px-3 py-1 rounded-lg hover:bg-gray-50">ููุงููุฉ ูููู ุงูุฃูุฑ</a>
        <a href="#advisors-admin" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงููุณุชุดุงุฑูู</a>
        <a href="#bookings" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุญุฌูุฒุงุช</a>
        <a href="#governance" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุญูููุฉ</a>
        <a href="#policies" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุฎุตูุตูุฉ</a>
        <a href="#terms" class="px-3 py-1 rounded-lg hover:bg-gray-50">ุงูุดุฑูุท</a>
      </div>
    </nav>
  </header>

  <div class="max-w-7xl mx-auto px-4 py-6 grid md:grid-cols-[260px_1fr] gap-6">
    <!-- Sidebar -->
    <aside class="bg-white border rounded-2xl p-4 h-max hidden md:block">
      <nav class="space-y-1 text-sm" aria-label="ุงูุชููู ุงูุฌุงูุจู">
        <a href="#about" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-circle-info ml-2"></i>ุนู/ููุงุฐุง ุชูุงููุ</a>
        <a href="#about-full" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-bullseye ml-2"></i>ุนู ุงูููุตูุฉ ูุงูุฑุคูุฉ</a>
        <a href="#impact" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-chart-column ml-2"></i>ุงูุฃุซุฑ ุงููุชููุน</a>
        <a href="#accounts" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-users ml-2"></i>ุงูุญุณุงุจุงุช ูุงูุฎุฏูุงุช</a>
        <a href="#subs" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-id-card ml-2"></i>ุงูุงุดุชุฑุงูุงุช</a>
        <a href="#sponsor" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-hand-holding-heart ml-2"></i>ุจุงูุงุช ุงูุฑุนุงูุฉ</a>
        <a href="#support" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-life-ring ml-2"></i>ุงูุฏุนู ุงูููู</a>
        <a href="#kpis" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-chart-line ml-2"></i>ููุญุฉ ุงููุคุดุฑุงุช</a>
        <a href="#test" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-heart ml-2"></i>ุงุฎุชุจุงุฑ ุงูุชูุงูู (30 ุณุคุงููุง)</a>
        <a href="#verify" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-qrcode ml-2"></i>ุงุณุชุนูุงู ุงูุฌูุงุช</a>
        <a href="#wali" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-file-signature ml-2"></i>ููุงููุฉ ูููู ุงูุฃูุฑ</a>
        <a href="#advisors-admin" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-user-tie ml-2"></i>ุฅุฏุงุฑุฉ ุงููุณุชุดุงุฑูู</a>
        <a href="#bookings" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-calendar-check ml-2"></i>ุญุฌูุฒุงุช ุงูุฌูุณุงุช</a>
        <a href="#governance" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-scale-balanced ml-2"></i>ุงูุญูููุฉ ูุงูุงูุชุซุงู</a>
        <a href="#policies" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-shield ml-2"></i>ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a>
        <a href="#terms" class="block px-3 py-2 rounded-lg hover:bg-gray-50"><i class="fa-solid fa-scroll ml-2"></i>ุงูุดุฑูุท ูุงูุฃุญูุงู</a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="space-y-6">

      <!-- Hero / ููุงุฐุง ุชูุงูู -->
      <section id="about" class="hero card">
        <h1 class="text-xl md:text-2xl font-extrabold mb-2 title">ููุงุฐุง ยซุชูุงููยปุ</h1>
        <p class="leading-7 muted">
          ยซุชูุงูู | Tawฤfuqยป ููุตูุฉ ูุทููุฉ ุฐููุฉ ุชูุนูู ุงูููุจููู ุนูู ุงูุฒูุงุฌ ุนูู ุงุชุฎุงุฐ ูุฑุงุฑ ูุงุนู ููุณุชุฏุงู ุนุจุฑ
          ุงุฎุชุจุงุฑ ุชูุงูู ูููููุ ูุชูุงุตู ุดุฑุนู ุจุฅุดุฑุงูุ ูุฅุฑุดุงุฏ ุฃุณุฑู ูุชุฎุตุตุ ูุน ุญูุงูุฉ ุฎุตูุตูุฉ ุนุงููุฉ ูุชูุงููุงุช ุญููููุฉ ููุซููุฉ.
        </p>
        <div class="mt-4 flex flex-wrap gap-2 text-sm">
          <span class="chip"><span>๐</span> ุฎุตูุตูุฉ ูุญูููุฉ ุนุงุฏูุฉ</span>
          <span class="chip"><span>๐</span> ูุคุดุฑุงุช ูุงุจูุฉ ููููุงุณ</span>
          <span class="chip"><span>๐จโโ๏ธ</span> ูุณุชุดุงุฑูู ูุนุชูุฏูู</span>
          <span class="chip"><span>๐งญ</span> ุฑุญูุฉ ูุฑุดูุฏุฉ ููุงุถุญุฉ</span>
        </div>
      </section>

      <!-- ุนู ุงูููุตูุฉ | ุงูุฑุคูุฉ | ุงูุฑุณุงูุฉ | ุงูููู | ุงูุฃูุฏุงู -->
      <section id="about-full" class="card">
        <div class="flex flex-wrap items-center gap-2 mb-3 text-sm">
          <span class="chip">๐ณ๏ธ ุฅุญุฏู ูุจุงุฏุฑุงุช ุจุฑูุงูุฌ ุดุจุงุจ ุงูููููุฉ ยซุญุตููยป ุงููุทูู</span>
          <span class="chip">๐ ุญูุงูุฉ ุจูุงูุงุช ูุฎุตูุตูุฉ</span>
        </div>

        <h2 class="text-xl font-bold mb-2 title">ุนู ุงูููุตูุฉ</h2>
        <p class="text-slate-700 leading-7">
          ยซุชูุงูู | Tawฤfuqยป ููุตูุฉ ูุทููุฉ ุฐููุฉ ุชูุธูู ุฑุญูุฉ ุงูุฎุทุจุฉ ูุชุฏุนู ูุฑุงุฑ ุงูุฒูุงุฌ ุงููุงุนู ุนุจุฑ ุงุฎุชุจุงุฑุงุช ุชูุงูู ูููููุฉุ
          ุชูุงุตู ุดุฑุนู ุจุฅุดุฑุงูุ ูุญุชูู ุชูุนูู ูุตูุฑุ ูุฅุฑุดุงุฏ ุฃุณุฑู ูุชุฎุตุตุ ูุน ุชูุงููุงุช ุญููููุฉ ููุชุญูู ูุญูุงูุฉ ุงูุฎุตูุตูุฉุ
          ุถูู ุจูุฆุฉ ุฑูููุฉ ุขููุฉ ุชุนุฒุฒ ุฌูุฏุฉ ุงูุญูุงุฉ ุงูุฃุณุฑูุฉ.
        </p>

        <div class="grid md:grid-cols-3 gap-6 mt-6">
          <div>
            <h3 class="font-bold text-brand-dk mb-1">ุงูุฑุคูุฉ</h3>
            <p class="text-sm text-slate-700">ุฃู ุชููู ยซุชูุงููยป ุงููุฑุฌุน ุงููุทูู ุงูุฃูู ูุจูุงุก ุฃุณุฑ ูุงุซูุฉ ููุณุชุฏุงูุฉุ ูุฎูุถ ุงูุทูุงู ุงููุจูุฑ ูู ุงูููููุฉ.</p>
          </div>
          <div>
            <h3 class="font-bold text-brand-dk mb-1">ุงูุฑุณุงูุฉ</h3>
            <p class="text-sm text-slate-700">ุชูููู ุงูููุจููู ุนูู ุงูุฒูุงุฌ ูู ุงุชุฎุงุฐ ูุฑุงุฑ ูุงุนู ูุงุฆู ุนูู ุจูุงูุงุช ููุคุดุฑุงุช ุนุงุฏูุฉุ ูุชูููุฑ ุฅุฑุดุงุฏ ูุชุฎุตุต ูุญููู ููุงุท ุงูุงุฎุชูุงู ุฅูู ูุฑุต ููุชูุงููุ ุถูู ุฅุทุงุฑ ูุญุชุฑู ุงูููู ูุงูุถูุงุจุท ุงูุดุฑุนูุฉ.</p>
          </div>
          <div>
            <h3 class="font-bold text-brand-dk mb-1">ุงูููู</h3>
            <ul class="text-sm text-slate-700 list-disc pr-5 space-y-1">
              <li>ุงููุฒุงูุฉ ูุงูุงูุชุฒุงู ุงูุดุฑุนู</li>
              <li>ุงูุฎุตูุตูุฉ ูุญูุงูุฉ ุงูุจูุงูุงุช</li>
              <li>ุงูุนุฏุงูุฉ ุงูุฎูุงุฑุฒููุฉ</li>
              <li>ุงูุดุฑุงูุฉ ุงููุฌุชูุนูุฉ</li>
              <li>ุงูุฃุซุฑ ุงููุงุจู ููููุงุณ</li>
            </ul>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="font-bold text-brand-dk mb-1">ุงูุฃูุฏุงู ุงูุงุณุชุฑุงุชูุฌูุฉ</h3>
          <ul class="text-sm text-slate-700 list-disc pr-5 space-y-1">
            <li>ุฑูุน ุฌูุฏุฉ ูุฑุงุฑ ุงูุฒูุงุฌ ูุฏู ุงููุณุชุฎุฏููู.</li>
            <li>ุฎูุถ ุงูุทูุงู ุงููุจูุฑ ุจูู ูุณุชุฎุฏูู ุงูููุตูุฉ.</li>
            <li>ุชุฎููุถ ุชุนุซูุฑ ุชูููู ุงูุฒูุงุฌ ูุฏู ุงูุดุฑูุงุก ุนุจุฑ ุงูุชุฃููู ุงููุณุจู.</li>
            <li>ุชูุณูุน ุงูุชุบุทูุฉ ุงูุฌุบุฑุงููุฉ ูุงููุฌุชูุนูุฉ ุฏุงุฎู ููุงุทู ุงูููููุฉ.</li>
            <li>ุชุนุฒูุฒ ุงูุฎุตูุตูุฉ ูุงูุญูููุฉ ูุงูุงูุชุซุงู ูู ุงูุชุดุบูู ูุงูุชุญููู.</li>
          </ul>
        </div>
      </section>

      <!-- ุงูุฃุซุฑ ุงููุชููุน (ููุญุฉ ูุตุบูุฑุฉ) -->
      <section id="impact" class="card">
        <div class="flex items-center justify-between gap-3 flex-wrap">
          <h2 class="text-xl font-bold title">ุงูุฃุซุฑ ุงููุชููุน</h2>
          <div class="text-sm muted">ููู ุชูููุฏูุฉ โ ูุงุจูุฉ ููุชุญุฏูุซ ุจุจูุงูุงุช ูุนููุฉ</div>
        </div>

        <div class="grid md:grid-cols-3 gap-6 mt-4">
          <div class="p-4 rounded-xl border bg-white">
            <div class="text-sm muted">ูุชูุณุท ูุณุจุฉ ุงูุชูุงูู</div>
            <div class="text-3xl font-extrabold text-brand-dk mt-1">78%</div>
            <div class="text-xs mt-1">ูุนููุฉ ุฃูููุฉ</div>
          </div>
          <div class="p-4 rounded-xl border bg-white">
            <div class="text-sm muted">ุฑุถุง ุงููุณุชุฎุฏููู ุนู ุงูุชูุฑูุฑ</div>
            <div class="text-3xl font-extrabold text-brand-dk mt-1">86%</div>
            <div class="text-xs mt-1">ูุณุฎุฉ ุชุฌุฑูุจูุฉ</div>
          </div>
          <div class="p-4 rounded-xl border bg-white">
            <div class="text-sm muted">ุฌูุณุงุช ุงูุฅุฑุดุงุฏ ุงููุญุฌูุฒุฉ</div>
            <div class="text-3xl font-extrabold text-brand-dk mt-1">124</div>
            <div class="text-xs mt-1">ุขุฎุฑ 90 ููููุง</div>
          </div>
        </div>

        <div class="mt-6">
          <canvas id="impactChart" height="110" aria-label="ุฑุณู ุจูุงูู ููุฃุซุฑ ุงููุชููุน"></canvas>
        </div>
      </section>

      <!-- Accounts & Services -->
      <section id="accounts" class="card">
        <h2 class="text-xl font-bold mb-4">ุงูุญุณุงุจุงุช ูุงูุฎุฏูุงุช</h2>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="border rounded-xl p-4">
            <h3 class="font-bold text-brand-dk mb-1">ุญุณุงุจ ุงูุฃูุฑุงุฏ</h3>
            <ul class="list-disc pr-5 text-sm text-gray-700 space-y-1">
              <li>ุชูุซูู ุงููููุฉ</li><li>ุงุฎุชุจุงุฑ ุงูุชูุงูู</li><li>ุงูุชูุงุตู ุงูุดุฑุนู ุจุฅุดุฑุงู</li><li>ุญุฌุฒ ุฌูุณุงุช</li><li>ุฏูุฑุงุช ูุง ูุจู ุงูุฒูุงุฌ</li>
            </ul>
          </div>
          <div class="border rounded-xl p-4">
            <h3 class="font-bold text-brand-dk mb-1">ุฃูููุงุก ุงูุฃููุฑ</h3>
            <ul class="list-disc pr-5 text-sm text-gray-700 space-y-1">
              <li>ุฑุจุท ุงูุญุณุงุจ</li><li>ุงุทูุงุน ุจุฅุฐู</li><li>ููุงููุฉ ุฑูููุฉ</li>
            </ul>
          </div>
          <div class="border rounded-xl p-4">
            <h3 class="font-bold text-brand-dk mb-1">ุงููุณุชุดุงุฑูู ูุงููุฑุงูุฒ</h3>
            <ul class="list-disc pr-5 text-sm text-gray-700 space-y-1">
              <li>ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช</li><li>ุชูุงุฑูุฑ ุงุณุชุดุงุฑูุฉ</li><li>ุชุตููู ูุชูููู</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Subscriptions -->
      <section id="subs" class="card">
        <h2 class="text-xl font-bold mb-3">ุงูุงุดุชุฑุงูุงุช</h2>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="border rounded-xl p-4">
            <div class="font-bold">ุฃุณุงุณู</div>
            <div class="text-2xl font-extrabold text-brand">49 ุฑ.ุณ</div>
            <ul class="text-sm text-gray-700 list-disc pr-5 mt-2">
              <li>ุงูุชุญูู ูู ุงููููุฉ</li>
              <li>ุงุฎุชุจุงุฑ ุชูุงูู ุฃุณุงุณู</li>
            </ul>
            <button class="mt-3 btn btn-brand w-full" onclick="savePlan('basic')" aria-label="ุงุดุชุฑู ูู ุงูุจุงูุฉ ุงูุฃุณุงุณูุฉ">ุงุดุชุฑู</button>
          </div>
          <div class="border rounded-xl p-4">
            <div class="font-bold">ูุชูุฏูู</div>
            <div class="text-2xl font-extrabold text-brand">149 ุฑ.ุณ</div>
            <ul class="text-sm text-gray-700 list-disc pr-5 mt-2">
              <li>ุงุฎุชุจุงุฑ 30 ุณุคุงููุง</li>
              <li>ุชูุฑูุฑ ูุญุงูุฑ ููุตู</li>
            </ul>
            <button class="mt-3 btn btn-brand w-full" onclick="savePlan('pro')">ุงุดุชุฑู</button>
          </div>
          <div class="border rounded-xl p-4">
            <div class="font-bold">ูุฎุจูู</div>
            <div class="text-2xl font-extrabold text-brand">299 ุฑ.ุณ</div>
            <ul class="text-sm text-gray-700 list-disc pr-5 mt-2">
              <li>ุฌูุณุฉ ุงุณุชุดุงุฑูุฉ</li>
              <li>ุดูุงุฏุฉ ุชูุงูู PDF</li>
            </ul>
            <button class="mt-3 btn btn-brand w-full" onclick="savePlan('elite')">ุงุดุชุฑู</button>
          </div>
        </div>
      </section>

      <!-- Sponsors doubled -->
      <section id="sponsor" class="card">
        <h2 class="text-xl font-bold mb-3">ุจุงูุงุช ุงูุฑุนุงูุฉ (ูุถุงุนูุฉ)</h2>
        <div class="grid md:grid-cols-4 gap-4">
          <div class="border rounded-xl p-4"><div class="font-bold">ุจุฑููุฒูุฉ</div><div class="text-2xl font-extrabold text-brand">100,000 ุฑ.ุณ</div></div>
          <div class="border rounded-xl p-4"><div class="font-bold">ูุถูุฉ</div><div class="text-2xl font-extrabold text-brand">300,000 ุฑ.ุณ</div></div>
          <div class="border rounded-xl p-4"><div class="font-bold">ุฐูุจูุฉ</div><div class="text-2xl font-extrabold text-brand">600,000 ุฑ.ุณ</div></div>
          <div class="border rounded-xl p-4"><div class="font-bold">ุจูุงุชูููุฉ</div><div class="text-2xl font-extrabold text-brand">1,500,000 ุฑ.ุณ</div></div>
        </div>
      </section>

      <!-- Support -->
      <section id="support" class="card">
        <h2 class="text-xl font-bold mb-2">ุงูุฏุนู ุงูููู</h2>
        <div class="grid md:grid-cols-3 gap-3">
          <label class="text-sm">ุงูุงุณู<input id="supName" class="mt-1 w-full border rounded-lg px-3 py-2" aria-label="ุงูุงุณู"/></label>
          <label class="text-sm">ุงูุจุฑูุฏ<input id="supMail" type="email" class="mt-1 w-full border rounded-lg px-3 py-2" aria-label="ุงูุจุฑูุฏ"/></label>
          <label class="text-sm md:col-span-3">ุงูุฑุณุงูุฉ<textarea id="supMsg" class="mt-1 w-full border rounded-lg px-3 py-2" rows="3" aria-label="ูุต ุงูุฑุณุงูุฉ"></textarea></label>
        </div>
        <div class="mt-3 flex gap-2">
          <button class="btn btn-brand" onclick="saveSupportDraft()">ุญูุธ ูุณูุฏุฉ</button>
          <button class="btn btn-ghost" onclick="clearSupportDraft()">ูุณุญ</button>
        </div>
      </section>

      <!-- KPIs / Charts -->
      <section id="kpis" class="card">
        <h2 class="text-xl font-bold mb-3">ููุญุฉ ูุคุดุฑุงุช ุชุดุบูููุฉ (ุชุฌุฑูุจูุฉ)</h2>
        <canvas id="kpiChart" height="100" aria-label="ูุฎุทุท ูุคุดุฑุงุช ุชุดุบูููุฉ"></canvas>
      </section>

      <!-- Smart Test 30Q -->
      <section id="test" class="card">
        <h2 class="text-xl font-bold mb-4">ุงุฎุชุจุงุฑ ุงูุชูุงูู ุงูุฐูู (30 ุณุคุงููุง)</h2>
        <div class="grid md:grid-cols-3 gap-4 mb-4">
          <label class="text-sm">ุงูุฏูุฑ
            <select id="party" class="mt-1 w-full border rounded-lg px-3 py-2" aria-label="ุงูุฏูุฑ">
              <option value="male">ุฐูุฑ</option>
              <option value="female">ุฃูุซู</option>
            </select>
          </label>
          <label class="text-sm">ุงูุจูุฆุฉ/ุงูููุทูุฉ<input id="region" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: ุญุงุฆู"/></label>
          <label class="text-sm">ุงูุฏูุงูุฉ/ุงููุฐูุจ<input id="religion" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: ุงูุฅุณูุงู"/></label>
          <label class="text-sm">ุงูุนูุฑ<input id="age" type="number" min="16" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุงูุชุนููู<input id="edu" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุงููุถุน ุงููุงูู<select id="fin" class="mt-1 w-full border rounded-lg px-3 py-2"><option>ูุณุชูุฑ</option><option>ูุชูุณุท</option><option>ููุฏ ุงูุชุญุณู</option></select></label>
        </div>
        <div class="flex items-center gap-2 mb-3 flex-wrap">
          <button class="btn btn-brand" onclick="createSession()"><i class="fa-solid fa-link ml-2"></i>ุฅูุดุงุก ุฌูุณุฉ</button>
          <div class="text-sm">ุฑูุฒ ุงูุฌูุณุฉ: <span class="font-mono" id="sessCode">โ</span></div>
          <div class="flex items-center gap-2"><input id="joinCode" class="border rounded-lg px-2 py-1 text-sm" placeholder="ุฃุฏุฎู ุฑูุฒ ุฌูุณุฉ"/><button class="btn btn-ghost" onclick="joinSession()">ุงูุถูุงู</button></div>
        </div>

        <div id="questions" class="grid md:grid-cols-2 gap-3"></div>
        <div class="mt-3 flex items-center gap-2">
          <button class="btn btn-brand" onclick="submitAnswers()">ุงุญุชุณุงุจ ุงููุชุงุฆุฌ</button>
          <button class="btn btn-ghost" onclick="clearAnswers()">ูุณุญ ุงูุฅุฌุงุจุงุช</button>
        </div>

        <div id="resultsArea" class="mt-6 hidden">
          <h3 class="text-lg font-bold mb-1">ุงููุชูุฌุฉ</h3>
          <div class="text-2xl font-extrabold text-brand" id="finalScore">โ%</div>
          <div id="axisBreakdown" class="mt-2 text-sm"></div>
          <div class="mt-3 flex flex-wrap gap-2">
            <span class="badge">ุฑูู ุงูุชูุงูู: <span class="font-mono" id="compatCode">โ</span></span>
            <span class="badge">ุงูุชุงุฑูุฎ: <span id="compatDate">โ</span></span>
          </div>
          <div id="qrContainer" class="mt-3"></div>
          <div class="mt-3 flex gap-2">
            <button class="btn btn-brand" onclick="downloadCertificatePDF()"><i class="fa-solid fa-file-pdf ml-2"></i>ุชูุฒูู ุดูุงุฏุฉ PDF</button>
            <button class="btn btn-ghost" onclick="window.print()"><i class="fa-solid fa-print ml-2"></i>ุทุจุงุนุฉ</button>
          </div>
        </div>
      </section>

      <!-- Verify -->
      <section id="verify" class="card">
        <h2 class="text-xl font-bold mb-2">ุงุณุชุนูุงู ุงูุฌูุงุช ุจุฑูู ุงูุชูุงูู</h2>
        <div class="flex items-center gap-2">
          <input id="verifyCode" class="border rounded-lg px-3 py-2" placeholder="ูุซุงู: TWFQ-AB12C-3" aria-label="ุฑูู ุงูุชูุงูู"/>
          <button class="btn btn-brand" onclick="lookupVerification()">ุงุณุชุนูุงู</button>
        </div>
        <div id="verifyBox" class="mt-3 hidden"></div>
      </section>

      <!-- Wali consent -->
      <section id="wali" class="card">
        <h2 class="text-xl font-bold mb-2">ููุงููุฉ ูููู ุงูุฃูุฑ (ุชุฌุฑูุจูุฉ)</h2>
        <p class="text-sm text-gray-600 mb-3">ุจุนุฏ ุธููุฑ ุงููุชูุฌุฉุ ูููู ุชุณุฌูู ููุงููุฉ ูููู ุงูุฃูุฑ ุนูู ุฑูู ุงูุชูุงูู ุจุงุณุชุฎุฏุงู ุชูููุน ุฑููู ุจุณูุท.</p>
        <div class="grid md:grid-cols-3 gap-3 mb-2">
          <label class="text-sm">ุงุณู ูููู ุงูุฃูุฑ<input id="waliName" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุฑูู ุงููููุฉ<input id="waliNat" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุฑูู ุงูุชูุงูู<input id="waliCode" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="TWFQ-..."/></label>
        </div>
        <div class="border rounded-xl p-2 bg-white">
          <canvas id="signPad" class="w-full h-40" style="background:var(--sand); border-radius:.75rem;"></canvas>
        </div>
        <div class="mt-2 flex gap-2">
          <button class="btn btn-brand" onclick="saveWaliConsent()">ุญูุธ ุงูููุงููุฉ</button>
          <button class="btn btn-ghost" onclick="clearSign()">ูุณุญ ุงูุชูููุน</button>
        </div>
        <div id="waliMsg" class="text-sm mt-2"></div>
      </section>

      <!-- Advisors Admin -->
      <section id="advisors-admin" class="card">
        <h2 class="text-xl font-bold mb-2">ููุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุดุงุฑูู (ูุญูู ููุชุฌุฑุจุฉ)</h2>
        <div class="grid md:grid-cols-4 gap-3 mb-3">
          <label class="text-sm">ุงูุงุณู<input id="advName" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุงูุชุฎุตุต<input id="advSpec" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="ุฃุณุฑู/ููุณู/ุดุฑุนู"/></label>
          <label class="text-sm">ุฃููุงุช ูุชุงุญุฉ (ูุซุงู: ุงูุฃุญุฏ 6โ9|ุงูุฅุซููู 7โ10)<input id="advSlots" class="mt-1 w-full border rounded-lg px-3 py-2"/></label>
          <label class="text-sm">ุงูุญุงูุฉ<select id="advApproved" class="mt-1 w-full border rounded-lg px-3 py-2"><option value="0">ููุฏ ุงููุฑุงุฌุนุฉ</option><option value="1">ูุนุชูุฏ</option></select></label>
        </div>
        <div class="flex gap-2 mb-3">
          <button class="btn btn-brand" onclick="addAdvisor()">ุฅุถุงูุฉ</button>
          <button class="btn btn-ghost" onclick="seedAdvisors()">ุชุนุจุฆุฉ ุฃูุซูุฉ</button>
        </div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead><tr class="text-right text-gray-600 border-b"><th class="py-2">#</th><th>ุงูุงุณู</th><th>ุงูุชุฎุตุต</th><th>ุงูุฃููุงุช</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead>
            <tbody id="advTable"></tbody>
          </table>
        </div>
      </section>

      <!-- Bookings -->
      <section id="bookings" class="card">
        <h2 class="text-xl font-bold mb-2">ุญุฌูุฒุงุช ุงูุฌูุณุงุช (ุชุฌุฑูุจูุฉ ูุญููุฉ)</h2>
        <p class="text-sm text-gray-600 mb-4">ุงุญุฌุฒ ุฌูุณุฉ ูุน ูุณุชุดุงุฑ ูุนุชูุฏ. ุชูุญููุธ ุงูุญุฌูุฒุงุช ูุญูููุง ูุฃุบุฑุงุถ ุงูุนุฑุถ.</p>

        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <label class="block text-sm">ุงุฎุชูุงุฑ ุงููุณุชุดุงุฑ
            <select id="bkAdvisor" class="mt-1 w-full border rounded-lg px-3 py-2"></select>
          </label>
          <label class="block text-sm">ููุน ุงูุฌูุณุฉ
            <select id="bkType" class="mt-1 w-full border rounded-lg px-3 py-2">
              <option value="ุงุณุชุดุงุฑุฉ ุฃุณุฑูุฉ 30 ุฏูููุฉ">ุงุณุชุดุงุฑุฉ ุฃุณุฑูุฉ 30 ุฏูููุฉ</option>
              <option value="ุงุณุชุดุงุฑุฉ ููุณูุฉ 45 ุฏูููุฉ">ุงุณุชุดุงุฑุฉ ููุณูุฉ 45 ุฏูููุฉ</option>
              <option value="ุงุณุชุดุงุฑุฉ ุดุฑุนูุฉ 30 ุฏูููุฉ">ุงุณุชุดุงุฑุฉ ุดุฑุนูุฉ 30 ุฏูููุฉ</option>
            </select>
          </label>
          <label class="block text-sm">ุงูุชุงุฑูุฎ
            <input id="bkDate" type="date" class="mt-1 w-full border rounded-lg px-3 py-2" />
          </label>
          <label class="block text-sm">ุงูููุช ุงููุชุงุญ
            <select id="bkTime" class="mt-1 w-full border rounded-lg px-3 py-2"></select>
          </label>
          <label class="block text-sm md:col-span-2">ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
            <input id="bkNotes" class="mt-1 w-full border rounded-lg px-3 py-2" placeholder="ุฃู ุชูุงุตูู ุฅุถุงููุฉ" />
          </label>
        </div>

        <div class="flex items-center gap-2 mb-6">
          <button class="btn btn-brand" onclick="addBooking()"><i class="fa-solid fa-check ml-2"></i>ุชุฃููุฏ ุงูุญุฌุฒ</button>
          <button class="btn btn-ghost" onclick="seedBookings()">ุชุนุจุฆุฉ ุฃูุซูุฉ</button>
        </div>

        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-right text-gray-600 border-b">
                <th class="py-2">ุฑูู ุงูุญุฌุฒ</th><th>ุงููุณุชุดุงุฑ</th><th>ุงูููุน</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูููุช</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody id="bkTable"></tbody>
          </table>
        </div>
      </section>

      <!-- Governance -->
      <section id="governance" class="card">
        <h2 class="text-xl font-bold mb-2">ุงูุญูููุฉ ูุงูุงูุชุซุงู</h2>
        <ul class="list-disc pr-5 text-sm text-gray-700 space-y-1">
          <li>ุฅูุตุงู ุงูุฎูุงุฑุฒููุงุช ููุฑุงุฌุนุฉ ุฑุจุน ุณูููุฉ</li>
          <li>ุณุฌูุงุช ุฅุดุฑุงููุฉ ูููุญุงุฏุซุงุช ููู ุงูุถูุงุจุท ุงูุดุฑุนูุฉ</li>
          <li>ุฅุฏุงุฑุฉ ุงูุญูุงุฏุซ ูุณูุงุณุฉ ุงูุงุญุชูุงุธ ุจุงูุจูุงูุงุช</li>
          <li>ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูุชุฎุฒูู ูุญูู ุฏุงุฎู ุงูููููุฉ</li>
          <li>ุฌูุฉ ูุณุคูู ุญูุงูุฉ ุงูุจูุงูุงุช (DPO): <span class="underline">dpo@talbiya.sa</span></li>
        </ul>
      </section>

      <!-- Policies & Terms -->
      <section id="policies" class="card">
        <h2 class="text-xl font-bold mb-2">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ (ูุฎุชุตุฑ)</h2>
        <p class="text-sm text-gray-700">ุชูุถุญ ูุฐู ุงูุณูุงุณุฉ ููููุฉ ูุนุงูุฌุฉ ุจูุงูุงุช ุงููุณุชุฎุฏูููุ ูุน ุงูุชุฒุงู ูุงูู ุจุงูููุงุฆุญ ุฐุงุช ุงูุตูุฉ ุฏุงุฎู ุงูููููุฉ. ุชุชู ุนูููุฉ ุงูุชุญูู ุนุจุฑ ูููุงุช ุญููููุฉุ ูุชูุณุชุฎุฏู ุงูุจูุงูุงุช ูุฃุบุฑุงุถ ุชุดุบูููุฉ ูุฅุญุตุงุฆูุฉ ุจุนุฏ ุฅุฎูุงุก ุงููููุฉ.</p>
      </section>
      <section id="terms" class="card">
        <h2 class="text-xl font-bold mb-2">ุงูุดุฑูุท ูุงูุฃุญูุงู (ูุฎุชุตุฑ)</h2>
        <p class="text-sm text-gray-700">ุจุงุณุชุฎุฏุงูู ุงูููุตูุฉุ ูุฃูุช ุชูุงูู ุนูู ุงูุงูุชุฒุงู ุจุงูุถูุงุจุท ุงูุดุฑุนูุฉ ูุงูุณููููุฉุ ูุนุฏู ุฅุณุงุกุฉ ุงุณุชุฎุฏุงู ูููุงุช ุงูุชูุงุตู. ููููู ุชุนููู ุฃู ุฅููุงู ุงูุญุณุงุจ ุนูุฏ ูุฎุงููุฉ ุงูุณูุงุณุงุช.</p>
      </section>

      <footer class="text-xs text-gray-600 py-6">
        ยฉ ุฌููุน ุงูุญููู ูุญููุธุฉ ูุดุฑูุฉ <span class="font-semibold">ุชูุจูุฉ ููุจุญุซ ูุงูุชุทููุฑ</span>.
      </footer>
    </main>
  </div>

  <!-- ุณูุฑุจุช ุงูุชุทุจูู -->
  <script>
  // --- Toast helper ---
  function notify(type, msg){
    const el = document.getElementById('toast');
    const bg = type==='ok' ? 'bg-green-600' : type==='warn' ? 'bg-yellow-600' : 'bg-red-600';
    el.className = \`fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg text-white \${bg}\`;
    el.textContent = msg; el.style.opacity=1; el.classList.remove('hidden');
    setTimeout(()=>{ el.style.opacity=0; setTimeout(()=>el.classList.add('hidden'), 300); }, 2500);
  }

  // --- LocalStorage helpers ---
  const PLAN_KEY='tawafuq_plan';
  function savePlan(name){ localStorage.setItem(PLAN_KEY, name); notify('ok','ุชู ุญูุธ ุงูุจุงูุฉ: '+name); }

  // Support draft
  const SUP_KEY='tawafuq_support_draft_v1';
  function saveSupportDraft(){ const o={n:supName.value,m:supMail.value,t:supMsg.value}; localStorage.setItem(SUP_KEY, JSON.stringify(o)); notify('ok','ุชู ุญูุธ ุงููุณูุฏุฉ'); }
  function clearSupportDraft(){ localStorage.removeItem(SUP_KEY); supName.value=''; supMail.value=''; supMsg.value=''; notify('ok','ุชู ุงููุณุญ'); }
  function restoreSupportDraft(){ try{ const o=JSON.parse(localStorage.getItem(SUP_KEY)||'{}'); if(o.n) supName.value=o.n; if(o.m) supMail.value=o.m; if(o.t) supMsg.value=o.t; }catch(e){} }

  // --- Advisors Admin (Local) ---
  const ADV_KEY='tawafuq_advisors_v1';
  function loadAdvisors(){ try{ return JSON.parse(localStorage.getItem(ADV_KEY))||[] }catch(e){ return [] } }
  function saveAdvisors(x){ localStorage.setItem(ADV_KEY, JSON.stringify(x)); }
  function addAdvisor(){
    const a={ name:advName.value||'ูุณุชุดุงุฑ', spec:advSpec.value||'ุฃุณุฑู', slots:advSlots.value||'ุงูุฃุญุฏ 6โ9', approved: advApproved.value==='1' };
    const list=loadAdvisors(); list.push(a); saveAdvisors(list); renderAdvisors(); notify('ok','ุชูุช ุงูุฅุถุงูุฉ');
    advName.value=''; advSpec.value=''; advSlots.value=''; advApproved.value='0';
  }
  function deleteAdvisor(i){ const list=loadAdvisors(); list.splice(i,1); saveAdvisors(list); renderAdvisors(); }
  function seedAdvisors(){ const demo=[
    {name:'ุฃ. ูุฏู ุงูุนุชูุจู', spec:'ุฃุณุฑู', slots:'ุงูุฃุญุฏ 6โ9|ุงูุซูุงุซุงุก 7โ10', approved:true},
    {name:'ุฏ. ูุงุฒู ุงููุญุทุงูู', spec:'ููุณู', slots:'ุงูุฅุซููู 6โ9|ุงูุฃุฑุจุนุงุก 6โ9', approved:false},
    {name:'ุงูุดูุฎ. ุจูุฏุฑ ุงูุณุจูุนู', spec:'ุดุฑุนู', slots:'ุงูุฎููุณ 7โ9', approved:true},
  ]; saveAdvisors(demo); renderAdvisors(); notify('ok','ุชูุช ุชุนุจุฆุฉ ุงูุฃูุซูุฉ'); }
  function renderAdvisors(){
    const body=document.getElementById('advTable'); if(!body) return;
    const list=loadAdvisors(); let html='';
    list.forEach((a,i)=>{
      html+=\`<tr class="border-b"><td class="py-2">\${i+1}</td><td>\${a.name}</td><td>\${a.spec}</td><td>\${a.slots}</td><td>\${a.approved?'ูุนุชูุฏ':'ููุฏ ุงููุฑุงุฌุนุฉ'}</td><td><button class="px-2 py-1 text-xs border rounded-lg text-red-700" onclick="deleteAdvisor(\${i})">ุญุฐู</button></td></tr>\`;
    });
    body.innerHTML=html;
  }

  // ===== Bookings Logic =====
  var BK_KEY = 'tawafuq_bookings_v1';
  function loadBookings(){ try { return JSON.parse(localStorage.getItem(BK_KEY)) || []; } catch(e){ return []; } }
  function saveBookings(list){ localStorage.setItem(BK_KEY, JSON.stringify(list)); }
  function rebuildAdvisorSelect(){
    var sel = document.getElementById('bkAdvisor'); if(!sel) return;
    var list = loadAdvisors(); var html='';
    for(var i=0;i<list.length;i++){
      var a=list[i]; html += '<option value="'+i+'">'+a.name+' โ '+a.spec+' ('+(a.approved? 'ูุนุชูุฏ':'ููุฏ ุงููุฑุงุฌุนุฉ')+')</option>';
    }
    sel.innerHTML = html; rebuildTimeSlots();
  }
  function parseSlotsToOptions(slots){
    if(!slots) return [];
    var first = String(slots).split('|')[0] || '';
    var m = first.match(/([0-9]+)\s*โ\s*([0-9]+)/);
    var s = m? parseInt(m[1]): 6; var e = m? parseInt(m[2]): 9; var out=[];
    for(var h=s; h<e; h++){ out.push(h+':00'); out.push(h+':30'); }
    return out;
  }
  function rebuildTimeSlots(){
    var timeSel = document.getElementById('bkTime'); if(!timeSel) return;
    var advSel = document.getElementById('bkAdvisor'); var list = loadAdvisors();
    var adv = list[advSel && advSel.value ? parseInt(advSel.value) : 0];
    var opts = parseSlotsToOptions(adv? adv.slots: ''); var html='';
    for(var i=0;i<opts.length;i++){ html += '<option value="'+opts[i]+'">'+opts[i]+'</option>'; }
    timeSel.innerHTML = html;
  }
  function uid(){ return 'BK-' + Math.random().toString(36).slice(2,8).toUpperCase(); }
  function addBooking(){
    var advIdx = parseInt((document.getElementById('bkAdvisor')||{}).value||0);
    var list = loadAdvisors(); var adv = list[advIdx];
    if(!adv){ notify('err','ุฃุถู ูุณุชุดุงุฑูุง ุฃูููุง ูู ููุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุดุงุฑูู.'); return; }
    var type = (document.getElementById('bkType')||{}).value;
    var date = (document.getElementById('bkDate')||{}).value;
    var time = (document.getElementById('bkTime')||{}).value;
    var notes = (document.getElementById('bkNotes')||{}).value||'';
    if(!date || !time){ notify('warn','ุงุฎุชุฑ ุงูุชุงุฑูุฎ ูุงูููุช.'); return; }
    var rec = { id: uid(), advisor: adv.name, spec: adv.spec, type: type, date: date, time: time, notes: notes, status: adv.approved? 'ูุคูุฏ' : 'ุจุงูุชุธุงุฑ ุงูุงุนุชูุงุฏ' };
    var B = loadBookings(); B.push(rec); saveBookings(B); renderBookings();
    try { bookingPDF(rec); } catch(e){}
    notify('ok','ุชู ุฅูุดุงุก ุงูุญุฌุฒ ูุฅุตุฏุงุฑ PDF');
  }
  function renderBookings(){
    var body = document.getElementById('bkTable'); if(!body) return;
    var B = loadBookings(); var html='';
    for(var i=0;i<B.length;i++){
      var r=B[i];
      html += '<tr class="border-b">'
        +'<td class="py-2 font-mono">'+r.id+'</td>'
        +'<td>'+r.advisor+' <span class="text-gray-400">('+r.spec+')</span></td>'
        +'<td>'+r.type+'</td>'
        +'<td>'+r.date+'</td>'
        +'<td>'+r.time+'</td>'
        +'<td>'+(r.status==='ูุคูุฏ' ? '<span class="badge" style="background:var(--sand); color:var(--brand-dk)">ูุคูุฏ</span>' : '<span class="badge">ุจุงูุชุธุงุฑ</span>')+'</td>'
        +'<td class="space-x-2 space-x-reverse">'
          +'<button class="px-2 py-1 text-xs border rounded-lg" onclick="bookingPDFByIndex('+i+')">PDF</button>'
          +'<button class="px-2 py-1 text-xs border rounded-lg text-red-700" onclick="deleteBooking('+i+')">ุญุฐู</button>'
        +'</td>'
      +'</tr>';
    }
    body.innerHTML = html; rebuildAdvisorSelect();
  }
  function deleteBooking(i){ var B=loadBookings(); B.splice(i,1); saveBookings(B); renderBookings(); }
  function bookingPDFByIndex(i){ var B=loadBookings(); var rec=B[i]; if(rec) bookingPDF(rec); }
  function bookingPDF(rec){
    var jsPDF = window.jspdf.jsPDF; var doc = new jsPDF('p','pt','a4');
    var y=48; doc.setFont('helvetica','bold'); doc.setFontSize(18);
    doc.text('ุชุฃููุฏ ุญุฌุฒ ุฌูุณุฉ โ Tawฤfuq Session Confirmation', 48, y); y+=24;
    doc.setFontSize(12); doc.setFont('helvetica','');
    doc.text('ุฑูู ุงูุญุฌุฒ: '+rec.id, 48, y); y+=16;
    doc.text('ุงููุณุชุดุงุฑ: '+rec.advisor+' ('+rec.spec+')', 48, y); y+=16;
    doc.text('ููุน ุงูุฌูุณุฉ: '+rec.type, 48, y); y+=16;
    doc.text('ุงูุชุงุฑูุฎ: '+rec.date+' | ุงูููุช: '+rec.time, 48, y); y+=16;
    doc.text('ุงูุญุงูุฉ: '+rec.status, 48, y); y+=24;
    if(rec.notes){ doc.text('ููุงุญุธุงุช: '+rec.notes, 48, y); y+=16; }
    doc.save('Booking_'+rec.id+'.pdf');
  }
  function seedBookings(){
    if(loadAdvisors().length===0) seedAdvisors();
    var a=loadAdvisors();
    var demo=[
      {id: uid(), advisor: (a[0]||{name:'ุฃ. ูุฏู'}).name, spec: 'ุฃุณุฑู', type:'ุงุณุชุดุงุฑุฉ ุฃุณุฑูุฉ 30 ุฏูููุฉ', date: new Date().toISOString().slice(0,10), time:'7:30', notes:'', status:'ูุคูุฏ'},
      {id: uid(), advisor: (a[1]||{name:'ุฏ. ูุงุฒู'}).name, spec: 'ููุณู', type:'ุงุณุชุดุงุฑุฉ ููุณูุฉ 45 ุฏูููุฉ', date: new Date(Date.now()+86400000).toISOString().slice(0,10), time:'6:00', notes:'', status:'ุจุงูุชุธุงุฑ'}
    ]; saveBookings(demo); renderBookings();
  }

  // --- KPI Chart (demo) ---
  function renderKPI(){
    if(!window.Chart) return;
    const ctx=document.getElementById('kpiChart'); if(!ctx) return;
    const data={ labels:['ุฌูุณุงุช','ุงุฎุชุจุงุฑุงุช','ูุณุจุฉ ุชูุงูู ูุชูุณุทุฉ','ูุฏู'], datasets:[{ label:'ูุคุดุฑุงุช', data:[loadBookings().length, 3, 78, 5] }] };
    new Chart(ctx,{ type:'bar', data, options:{ responsive:true, plugins:{legend:{display:false}} } });
  }

  // --- Smart Test Session ---
  const SESS_KEY='tawafuq_sessions_v3'; // sessions by code
  function loadSessions(){ try{ return JSON.parse(localStorage.getItem(SESS_KEY))||{} }catch(e){ return {} } }
  function saveSessions(o){ localStorage.setItem(SESS_KEY, JSON.stringify(o)); }

  function genBase(){ const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; let s=''; for(let i=0;i<5;i++){ s+=chars[Math.floor(Math.random()*chars.length)] } return s }
  function genCode(){ const base=genBase(); let sum=0; for(const ch of base){ sum+=ch.charCodeAt(0) } const chk=(sum%7).toString(); return \`TWFQ-\${base}-\${chk}\` }
  function validCodeFormat(code){ return /^TWFQ\-[A-Z0-9]{5}\-\d$/.test(code||'') }

  let currentCode=null, currentParty=null;
  function createSession(){
    currentParty = document.getElementById('party').value;
    const meta = { region:region.value||'', religion:religion.value||'', age:parseInt(age.value||'0'), edu:edu.value||'', fin:fin.value||'' };
    const code=genCode(); const sessions=loadSessions();
    sessions[code] = sessions[code]||{ male:null, female:null, meta:{} };
    sessions[code].meta[currentParty]=meta; saveSessions(sessions);
    currentCode=code; document.getElementById('sessCode').textContent=code; notify('ok','ุชู ุฅูุดุงุก ุงูุฌูุณุฉ: '+code);
    buildQuestions(); restoreProgress();
  }
  function joinSession(){
    const code=(document.getElementById('joinCode').value||'').trim().toUpperCase();
    if(!validCodeFormat(code)) return notify('warn','ุตูุบุฉ ุงูุฑูุฒ ุบูุฑ ุตุญูุญุฉ');
    const s=loadSessions()[code]; if(!s) return notify('err','ูุง ุชูุฌุฏ ุฌูุณุฉ ุจูุฐุง ุงูุฑูุฒ');
    currentCode=code; currentParty=document.getElementById('party').value;
    document.getElementById('sessCode').textContent=code; notify('ok','ุชู ุงูุงูุถูุงู ุฅูู ุงูุฌูุณุฉ');
    buildQuestions(); restoreProgress();
  }

  const AXES=[
    {key:'values', title:'ุงูููู', weight:0.25},
    {key:'goals', title:'ุงูุฃูุฏุงู', weight:0.20},
    {key:'traits', title:'ุงูุณูุงุช', weight:0.20},
    {key:'finance', title:'ุงููุงู', weight:0.15},
    {key:'comm', title:'ุงูุชูุงุตู', weight:0.20},
  ];
  const BANK={
    values:[
      'ุฃูููุฉ ุงูุงูุชุฒุงู ุงูุฏููู ูู ุงูุญูุงุฉ ุงูููููุฉ', 'ุฃููููุฉ ุงูุตุฏู ูุงูุดูุงููุฉ ูู ุงูุนูุงูุฉ', 'ุฏูุฑ ุงูุฃุณุฑุฉ ุงูููุชุฏุฉ ูู ุงุชุฎุงุฐ ุงููุฑุงุฑุงุช', 'ุงูุชูุณู ุจุงูุนุงุฏุงุช ูุงูุชูุงููุฏ', 'ุงููุฑููุฉ ุชุฌุงู ุงุฎุชูุงู ูุฌูุงุช ุงููุธุฑ ุงูุฏูููุฉ', 'ุงูุนูู ุงูุชุทูุนู ููููุฉ ูุดุชุฑูุฉ'
    ],
    goals:[
      'ุงูุฑุบุจุฉ ูู ุฅูุฌุงุจ ุงูุฃุทูุงู ุฎูุงู ุฃูู ุนุงููู', 'ุฃููููุฉ ุงูุงุณุชูุฑุงุฑ ุงูุณููู ูุจู ุงูุฅูุฌุงุจ', 'ุงูุชุทูุน ููุฏุฑุงุณุงุช ุงูุนููุง ุจุนุฏ ุงูุฒูุงุฌ', 'ุงูุทููุญ ุงููููู ูููุง ุงูุทุฑููู', 'ุงูุงุฏุฎุงุฑ ููุฏู ุทููู ุงููุฏู', 'ุงูุณูุฑ ูุงูุงุณุชูุดุงู ูุฃุณููุจ ุญูุงุฉ'
    ],
    traits:[
      'ุงููุฏุฑุฉ ุนูู ุถุจุท ุงูููุณ ุนูุฏ ุงูุฎูุงู', 'ุงูุชุณุงูุญ ุจุนุฏ ุงูุงุนุชุฐุงุฑ', 'ุงููุฑููุฉ ูู ุชุบููุฑ ุงูุฎุทุท', 'ุงูุงููุชุงุญ ุนูู ุชุฌุงุฑุจ ุฌุฏูุฏุฉ', 'ุงูุฏูุฉ ูู ุงูููุงุนูุฏ', 'ุญุจ ุงููุธุงู ูุงูุชุฑุชูุจ'
    ],
    finance:[
      'ุชูุณูู ุงููุตุงุฑูู ุจุดูู ูุชุณุงูู', 'ูุจูู ุงูููุฒุงููุฉ ุงูุดูุฑูุฉ ูุงูุงูุถุจุงุท ุจูุง', 'ุชูุถูู ุงูุงุฏุฎุงุฑ ุนูู ุงูุงุณุชููุงู', 'ุงูุงุณุชุนุฏุงุฏ ููุดูุงููุฉ ุงููุงููุฉ ุงููุงููุฉ', 'ุชูุงุณู ุฅุฏุงุฑุฉ ุฃููุงู ุงูุฃุณุฑุฉ', 'ุงูุฃููููุงุช ูู ุงููุฏุงูุง ูุงูุฑูุงู'
    ],
    comm:[
      'ุญูุงุฑ ูููู ูุง ููู ุนู 15 ุฏูููุฉ', 'ุชูุจูู ุงูููุฏ ุงูุจููุงุก', 'ุงูุงุนุชุฐุงุฑ ุงูุณุฑูุน ุนูุฏ ุงูุฎุทุฃ', 'ุงูุชุนุจูุฑ ุนู ุงููุดุงุนุฑ ุจุงูุชุธุงู', 'ุชูุถูู ุญู ุงูุฎูุงู ูู ููุณ ุงูููู', 'ุนุฏู ุฅุฏุฎุงู ุฃุทุฑุงู ุฎุงุฑุฌูุฉ ูุจูุฑูุง'
    ]
  };

  function buildQuestions(){
    const box=document.getElementById('questions'); if(!box) return; box.innerHTML='';
    let i=0; AXES.forEach(ax=>{
      BANK[ax.key].forEach(q=>{
        i++; const id=\`q_\${ax.key}_\${i}\`;
        const wrap=document.createElement('label'); wrap.className='text-sm block'; wrap.setAttribute('for', id);
        wrap.innerHTML = \`\${i}. \${q}<select id="\${id}" class="mt-1 w-full border rounded-lg px-3 py-2"><option value="">โ ุงุฎุชุฑ โ</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>\`;
        box.appendChild(wrap);
      })
    });
    // autosave
    box.querySelectorAll('select').forEach(sel=>{
      sel.addEventListener('change', ()=>{
        const key='tawafuq_progress_'+currentCode+'_'+currentParty; const obj=JSON.parse(localStorage.getItem(key)||'{}');
        obj[sel.id]=sel.value; localStorage.setItem(key, JSON.stringify(obj));
      });
    });
  }

  function restoreProgress(){
    if(!currentCode||!currentParty) return;
    const key='tawafuq_progress_'+currentCode+'_'+currentParty; const obj=JSON.parse(localStorage.getItem(key)||'{}');
    Object.keys(obj).forEach(id=>{ const el=document.getElementById(id); if(el) el.value=obj[id]; });
  }
  function clearAnswers(){ const box=document.getElementById('questions'); if(!box) return; box.querySelectorAll('select').forEach(s=>s.value=''); notify('ok','ุชู ุงููุณุญ'); }

  function gatherAnswers(){
    const box=document.getElementById('questions'); const answers={}; let valid=true;
    AXES.forEach(ax=>{ answers[ax.key]=[]; });
    box.querySelectorAll('select').forEach(s=>{ if(!s.value) valid=false; const [_,key]=s.id.split('_'); answers[key].push(parseInt(s.value)); });
    return {answers, valid};
  }

  function computeAxisScore(arr){ if(!arr.length) return 0; const sum=arr.reduce((a,b)=>a+b,0); const max=arr.length*5; return Math.round((sum/max)*100); }
  function similarityScore(a1,a2){ const len=Math.min(a1.length, a2.length); let sim=0; for(let i=0;i<len;i++){ sim += 1 - (Math.abs(a1[i]-a2[i])/4); } return Math.round((sim/len)*100); }

  function demoSimilarity(m,f){
    if(!m||!f) return 0; let s=0, n=0;
    if(m.age && f.age){ const d=Math.abs(m.age-f.age); s += (d<=3?100:(d<=6?70:40)); n++; }
    if(m.edu && f.edu){ s += (m.edu===f.edu?100:60); n++; }
    if(m.region && f.region){ s += (m.region===f.region?100:70); n++; }
    if(m.religion && f.religion){ s += (m.religion===f.religion?100:60); n++; }
    if(m.fin && f.fin){ s += (m.fin===f.fin?100:70); n++; }
    return Math.round(s/Math.max(n,1));
  }

  function submitAnswers(){
    if(!currentCode||!currentParty) return notify('warn','ุฃูุดุฆ ุฃู ุงูุถู ุฅูู ุฌูุณุฉ ุฃูููุง');
    const {answers, valid}=gatherAnswers(); if(!valid) return notify('warn','ุฃููู ุฌููุน ุงูุฅุฌุงุจุงุช');
    const sessions=loadSessions(); const S=sessions[currentCode]||{ male:null, female:null, meta:{} };
    const pack={ answers, meta:{ region:region.value, religion:religion.value, age:parseInt(age.value||'0'), edu:edu.value, fin:fin.value } };
    S[currentParty]=pack; sessions[currentCode]=S; saveSessions(sessions);

    if(S.male && S.female){
      const axisScores={}; let total=0;
      AXES.forEach(ax=>{
        const a1=S.male.answers[ax.key]; const a2=S.female.answers[ax.key];
        const sim=similarityScore(a1,a2); axisScores[ax.key]=sim; total += sim*ax.weight;
      });
      const dm = demoSimilarity(S.male.meta, S.female.meta);
      const final = Math.round(total*0.75 + dm*0.25);
      showResults(final, axisScores);
      localStorage.removeItem('tawafuq_progress_'+currentCode+'_male');
      localStorage.removeItem('tawafuq_progress_'+currentCode+'_female');
    } else {
      notify('ok','ุชู ุญูุธ ุฅุฌุงุจุงุชู. ุจุงูุชุธุงุฑ ุงูุทุฑู ุงูุขุฎุฑ.');
    }
  }

  function showResults(final, axis){
    const code = currentCode; const date=new Date().toLocaleDateString('ar-SA');
    document.getElementById('resultsArea').classList.remove('hidden');
    document.getElementById('finalScore').textContent=final+'%';
    document.getElementById('compatCode').textContent=code;
    document.getElementById('compatDate').textContent=date;
    const mapTitle={values:'ุงูููู', goals:'ุงูุฃูุฏุงู', traits:'ุงูุณูุงุช', finance:'ุงููุงู', comm:'ุงูุชูุงุตู'};
    let html=''; Object.keys(axis).forEach(k=>{ html+=\`<div class="badge">\${mapTitle[k]}: \${axis[k]}%</div> \` });
    document.getElementById('axisBreakdown').innerHTML=html;

    const qrBox=document.getElementById('qrContainer'); qrBox.innerHTML='';
    const div=document.createElement('div'); qrBox.appendChild(div);
    const payload = JSON.stringify({code, score:final});
    new QRCode(div, {text: payload, width:128, height:128});

    notify('ok','ุชู ุงุญุชุณุงุจ ุงููุชูุฌุฉ');
  }

  function dataURLFromQRCodeElement(el){
    const img=el.querySelector('img'); if(img) return img.src;
    const cvs=el.querySelector('canvas'); if(cvs) return cvs.toDataURL('image/png');
    return null;
  }

  function downloadCertificatePDF(){
    const jsPDF=window.jspdf.jsPDF; const doc=new jsPDF('p','pt','a4');
    const code=document.getElementById('compatCode').textContent||'';
    const score=document.getElementById('finalScore').textContent||'';
    const date=document.getElementById('compatDate').textContent||'';
    let y=56; doc.setFont('helvetica','bold'); doc.setFontSize(20);
    doc.text('ุดูุงุฏุฉ ุชูุงูู โ Tawฤfuq Compatibility Certificate', 48, y); y+=28;
    doc.setFont('helvetica',''); doc.setFontSize(12);
    doc.text('ุฑูู ุงูุชูุงูู: '+code, 48, y); y+=16; doc.text('ุงููุณุจุฉ ุงูููุงุฆูุฉ: '+score, 48, y); y+=16; doc.text('ุงูุชุงุฑูุฎ: '+date, 48, y); y+=24;
    const qc=document.getElementById('qrContainer'); const dataURL=dataURLFromQRCodeElement(qc);
    if(dataURL){ doc.addImage(dataURL, 'PNG', 48, y, 96, 96); y+=112; }
    doc.text('ูุฐู ุดูุงุฏุฉ ุชุฌุฑูุจูุฉ ูุญููุฉ ูุฃุบุฑุงุถ ุงูุนุฑุถ.', 48, y);
    doc.save('Tawafuq_Certificate_'+code+'.pdf');
  }

  // Verify lookup
  function lookupVerification(){
    const code=(document.getElementById('verifyCode').value||'').trim().toUpperCase();
    const box=document.getElementById('verifyBox'); box.classList.remove('hidden');
    if(!/^TWFQ\-[A-Z0-9]{5}\-\d$/.test(code||'')){ box.innerHTML='<div class="text-red-700">ุตูุบุฉ ุงูุฑูู ุบูุฑ ุตุญูุญุฉ.</div>'; return; }
    const S=loadSessions()[code]; if(!S||!S.male||!S.female){ box.innerHTML='<div class="text-yellow-700">ูุง ุชุชููุฑ ุจูุงูุงุช ููุชููุฉ ููุฐุง ุงูุฑูู.</div>'; return; }
    const axis={}; let total=0; AXES.forEach(ax=>{ const sim=similarityScore(S.male.answers[ax.key], S.female.answers[ax.key]); axis[ax.key]=sim; total+=sim*ax.weight; });
    const dm=demoSimilarity(S.male.meta,S.female.meta); const final=Math.round(total*0.75+dm*0.25);
    const mapTitle={values:'ุงูููู', goals:'ุงูุฃูุฏุงู', traits:'ุงูุณูุงุช', finance:'ุงููุงู', comm:'ุงูุชูุงุตู'};
    let badges=''; Object.keys(axis).forEach(k=>{ badges+=\`<span class="badge">\${mapTitle[k]}: \${axis[k]}%</span> \`; });
    box.innerHTML = \`<div class="p-3 bg-white border rounded-xl"><div class="text-lg font-bold text-brand">\${final}%</div><div class="mt-2">\${badges}</div><div class="text-xs text-gray-500 mt-2">ูุชูุฌุฉ ูุญุณูุจุฉ ูุญูููุง (ุชุฌุฑูุจู)</div></div>\`;
  }

  // Wali consent signature
  let drawing=false;
  function signInit(){ const c=document.getElementById('signPad'); if(!c) return; const ctx=c.getContext('2d'); ctx.strokeStyle='#000'; ctx.lineWidth=2; function pos(e){ const r=c.getBoundingClientRect(); const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left; const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top; return {x,y}; }
    c.addEventListener('mousedown',e=>{drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y)});
    c.addEventListener('mousemove',e=>{ if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); });
    window.addEventListener('mouseup',()=>drawing=false);
    c.addEventListener('touchstart',e=>{drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y)});
    c.addEventListener('touchmove',e=>{ if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); });
    window.addEventListener('touchend',()=>drawing=false);
  }
  function clearSign(){ const c=document.getElementById('signPad'); const ctx=c.getContext('2d'); ctx.clearRect(0,0,c.width,c.height); }
  function saveWaliConsent(){
    const name=waliName.value||''; const nat=waliNat.value||''; const code=(waliCode.value||'').toUpperCase();
    if(!name||!nat||!/^(TWFQ\-[A-Z0-9]{5}\-\d)$/.test(code)) return notify('warn','ุฃููู ุงูุจูุงูุงุช ูุชุญูู ูู ุตูุบุฉ ุงูุฑูู');
    const S=loadSessions(); if(!S[code]) return notify('err','ุฑูู ุชูุงูู ุบูุฑ ููุฌูุฏ');
    const c=document.getElementById('signPad'); const png=c.toDataURL('image/png');
    S[code].wali={ name, nat, sign: png, at: new Date().toISOString() }; saveSessions(S);
    document.getElementById('waliMsg').textContent='ุชู ุญูุธ ููุงููุฉ ูููู ุงูุฃูุฑ.'; notify('ok','ุญููุธุช ุงูููุงููุฉ');
  }

  // Impact chart
  function renderImpact(){
    const el = document.getElementById('impactChart');
    if(!el || !window.Chart) return;
    new Chart(el.getContext('2d'), {
      type: 'bar',
      data: {
        labels: ['ุงูุชูุงูู', 'ุฑุถุง ุงูุชูุฑูุฑ', 'ุญุฌูุฒุงุช/100'],
        datasets: [{ label: 'ุงูุฃุซุฑ ุงููุชููุน', data: [78, 86, 62], borderWidth: 1 }]
      },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins:{ legend:{ display:false } },
        scales: {
          y: { beginAtZero: true, ticks:{ stepSize: 20, color:'#334155' }, grid:{ color:'#e2e8f0' } },
          x: { ticks:{ color:'#334155' }, grid:{ display:false } }
        }
      }
    });
  }

  // Init
  document.addEventListener('DOMContentLoaded',function(){
    restoreSupportDraft(); renderAdvisors(); rebuildAdvisorSelect(); renderBookings(); renderKPI(); signInit(); renderImpact();
  });
  </script>
</body>
</html>
